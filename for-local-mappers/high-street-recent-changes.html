<!DOCTYPE html>
<html class="h-100">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>For Local Mappers</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="codemirror.css">

    <script src="codemirror.js" type="text/javascript"></script>
    <script src="mode/clike/clike.js" type="text/javascript"></script>
    <script src="util/multiplex.js" type="text/javascript"></script>


    <style type="text/css">
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
      main > .container {
        padding: 60px 15px 0;
      }
    </style>

  </head>


  <body class="d-flex flex-column h-100">

    <header>
        <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
          <div class="container-fluid">
            
              <a class="navbar-brand" href="/">OSM Queries | For Local Mappers</a>
            
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
              <ul class="navbar-nav mr-auto">
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Packages
                  </a>
                  <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="../index.html">Home</a>
                    
                      <a class="dropdown-item" href="..//for-local-mappers/index.html">For Local Mappers</a>
                    
                  </div>
                </li>
                
                
              </ul>
            </div>
          </div>
        </nav>
    </header>

      <main class="flex-shrink-0">
       <div class="container">
      <div class="row">
        <div class="col">
          <div class="row">
              <div id="query-viewer">
					<h2 property="title">Extract recently changed data for a typical UK high street</h2>
					
						<p property="description"><p>This is a variation of the query that extract information
about typical high street shops and amenities.</p>

<p>However it applies an additional filter to select just those
nodes, ways and relations that have been changed since
the 1st January 2021.</p>

<p>It does this using the &quot;newer&quot; filter which used to specify the
full date/time of interest.</p>

<p>The filter cannot be applied directly to the first union, so
the initial results are assigned to a variables called &quot;highstreet&quot;
and the filter applied to that.</p>
</p>
					
					<dl>
					  <dt>Source File</dt>
					  <dd><code>high-street-recent-changes.op</code></dd>
					  
					  <dt>Author</dt>
					  <dd><span property="creator">Leigh Dodds</span></dd>
					  
					  
					  
					</dl>
					<textarea id="overpass" cols="120" rows="50">/*
 This is a variation of the query that extract information
 about typical high street shops and amenities.

 However it applies an additional filter to select just those
 nodes, ways and relations that have been changed since
 the 1st January 2021.

 It does this using the "newer" filter which used to specify the
 full date/time of interest.

 The filter cannot be applied directly to the first union, so
 the initial results are assigned to a variables called "highstreet"
 and the filter applied to that.

 @title Extract recently changed data for a typical UK high street
 */
[bbox:{{bbox}}];
(
  nwr["building"="retail"];
  nwr["building"="supermarket"];
  nwr["building"="commercial"];

  nwr["amenity"="pub"];
  nwr["amenity"="bar"];
  nwr["amenity"="restaurant"];
  nwr["amenity"="cafe"];
  nwr["amenity"="library"];
  nwr["amenity"="bank"];
  nwr["amenity"="fast_food"];

)->.highstreet;
nwr.highstreet(newer:"2021-01-01T00:00:00Z");
out body;
>;
out skel qt;
</textarea>
					<script>
            CodeMirror.defineMIME("text/x-overpassQL", {
              name: "clike",
              keywords: (function (str) {
                var r = {};
                var a = str.split(" ");
                for (var i = 0; i < a.length; i++) r[a[i]] = true;
                return r;
              })(
                "out json xml custom popup timeout maxsize bbox" + // initial declarations
                  " date diff adiff" + //attic declarations
                  " foreach" + // block statements
                  " relation rel way node is_in area around user uid newer changed poly pivot nwr derived" + // queries
                  " out meta body skel tags ids count qt asc" + // actions
                  " center bb geom" // geometry types
                //+"r w n br bw" // recursors
              )
            });
            CodeMirror.defineMIME("text/x-overpassXML", "xml");
            CodeMirror.defineMode("xml+mustache", function (config) {
              return CodeMirror.multiplexingMode(
                CodeMirror.multiplexingMode(CodeMirror.getMode(config, "xml"), {
                  open: "{{",
                  close: "}}",
                  mode: CodeMirror.getMode(config, "text/plain"),
                  delimStyle: "mustache"
                }),
                {
                  open: "{{style:",
                  close: "}}",
                  mode: CodeMirror.getMode(config, "text/css"),
                  delimStyle: "mustache"
                }
              );
            });
            CodeMirror.defineMode("ql+mustache", function (config) {
              return CodeMirror.multiplexingMode(
                CodeMirror.multiplexingMode(
                  CodeMirror.getMode(config, "text/x-overpassQL"),
                  {
                    open: "{{",
                    close: "}}",
                    mode: CodeMirror.getMode(config, "text/plain"),
                    delimStyle: "mustache"
                  }
                ),
                {
                  open: "{{style:",
                  close: "}}",
                  mode: CodeMirror.getMode(config, "text/css"),
                  delimStyle: "mustache"
                }
              );
            });
					  var editor = CodeMirror.fromTextArea(document.getElementById("overpass"), {
						    height: "250px",
						    width: "250px",
						    autofocus: false,
						    readOnly: true,
                mode: "ql+mustache",
						    lineNumbers: true,
                lineWrapping: true,
                matchBrackets: true,
                closeTagEnabled: true,
                closeTagIndent: [
                  "osm-script",
                  "query",
                  "union",
                  "foreach",
                  "difference"
                ]
						  });
					</script>
          <h3>Test This Query</h3>
					<p>Try this query in Overpass Turbo:</p>
					<ul>
					    <li>
					      <a href="https://overpass-turbo.eu/?Q=%2F%2A%0A+This+is+a+variation+of+the+query+that+extract+information%0A+about+typical+high+street+shops+and+amenities.%0A%0A+However+it+applies+an+additional+filter+to+select+just+those%0A+nodes%2C+ways+and+relations+that+have+been+changed+since%0A+the+1st+January+2021.%0A%0A+It+does+this+using+the+%22newer%22+filter+which+used+to+specify+the%0A+full+date%2Ftime+of+interest.%0A%0A+The+filter+cannot+be+applied+directly+to+the+first+union%2C+so%0A+the+initial+results+are+assigned+to+a+variables+called+%22highstreet%22%0A+and+the+filter+applied+to+that.%0A%0A+%40title+Extract+recently+changed+data+for+a+typical+UK+high+street%0A+%2A%2F%0A%5Bbbox%3A%7B%7Bbbox%7D%7D%5D%3B%0A%28%0A++nwr%5B%22building%22%3D%22retail%22%5D%3B%0A++nwr%5B%22building%22%3D%22supermarket%22%5D%3B%0A++nwr%5B%22building%22%3D%22commercial%22%5D%3B%0A%0A++nwr%5B%22amenity%22%3D%22pub%22%5D%3B%0A++nwr%5B%22amenity%22%3D%22bar%22%5D%3B%0A++nwr%5B%22amenity%22%3D%22restaurant%22%5D%3B%0A++nwr%5B%22amenity%22%3D%22cafe%22%5D%3B%0A++nwr%5B%22amenity%22%3D%22library%22%5D%3B%0A++nwr%5B%22amenity%22%3D%22bank%22%5D%3B%0A++nwr%5B%22amenity%22%3D%22fast_food%22%5D%3B%0A%0A%29-%3E.highstreet%3B%0Anwr.highstreet%28newer%3A%222021-01-01T00%3A00%3A00Z%22%29%3B%0Aout+body%3B%0A%3E%3B%0Aout+skel+qt%3B%0A&R" target="_blank">https://overpass-turbo.eu/</a>
					    </li>
					</ul>

              </div>
          </div><!--/row-->
        </div><!--/span-->
      </div><!--/row-->

</div>

      </main>

       <footer class="footer mt-auto py-3 bg-light">
         <div class="container">
           <span class="text-muted">Generated with <a href="http://github.com/ldodds/overpass-doc">overpass-doc</a>.</span>
         </div>
       </footer>


  </body>
</html>
